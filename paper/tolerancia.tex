\section{Tolerância a Faltas - Fail, Freeze e Recover}

De forma a existir tolerância a faltas cada \textit{Server} tem um estado, podendo assim suportar diferentes comportamentos, tal como referido anteriormente na secção \ref{Server State}. Se o estado do \textit{Server} for \textit{PrimaryServer}, isto é assume o papel de servidor primário, então envia uma mensagem de \textit{I’m alive} ao respectivo servidor secundário (servidor com estado \textit{BackupServer}) a cada 10 segundos. Caso o servidor secundário não receba a mensagem após o tempo limite (15 segundos), este regista-se no Master como primário e cria uma nova instância de secundário.

A detecção de falha do servidor secundário por parte do servidor primário é também feita através de um temporizador. Este temporizador é iniciado quando na sequência de um pedido feito ao servidor primário este tenta replicar o pedido no servidor secundário, de forma a actualizá-lo. Se o servidor secundário não responder após o tempo limite de 15 segundos o servidor primário cria uma nova instância de secundário.

De forma a suportar os pedidos de \textit{Fail} e \textit{Freeze} existem os estados \textit{FailedState} e \textit{FrozeState}, respectivamente. Quando um \textit{Server} recebe o pedido de \textit{Fail} passa a ter o estado \textit{FailedState} e é desconectado do canal, no entando, no âmbito deste projecto, para permitir a recriação de um \textit{Server} a máquina (\textit{ServerMachine} referida na secção \ref{Server}) continua disponível de forma a que o outro \textit{Server} do par (primário, secundário) possa criar uma nova instância de um \textit{Server} na máquina onde o servidor que recebeu o pedido \textit{Fail} estava a correr. Ainda no âmbito deste projecto assumimos que quando um \textit{Server} recebe um pedido de \textit{Fail} a instância de \textit{Server} é removida e não pode ser recuperada usando o pedido \textit{Recover}.

Um \textit{Server} ao passar para o estado \textit{FrozeState}, devido ao pedido \textit{Freeze}, faz com que todos os pedidos enviados pelo cliente ou por outro \textit{Server} fiquem bloqueados. Caso o antigo estado do \textit{Server} fosse \textit{PrimaryState} deixará também de enviar mensagem de \textit{I’m alive} ao respectivo servidor secundário. Existem duas formas para o \textit{Server} abandonar este estado. Uma está relacionada com o pedido de \textit{Recover} que um cliente pode enviar, nesse caso o servidor voltará ao estado antigo (ao que tinha antes de receber o pedido de \textit{Freeze}) e responde a todos os pedidos que estavam pendentes. A outra forma foi já referida anteriormente no início desta secção e está relacionada com a detecção de falha do outro\textit{Server} do par (primário, secundário).