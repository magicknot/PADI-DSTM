\subsection{Commit e abort}

Antes de explicarmos como funciona o commit e o abort explicaremos uma opção tomada em relação ao uso de two-phase-commit (2PC). Tendo em conta o âmbito deste projecto e a abordagem pessimista que decidimos seguir, tal como descrevemos na secção \ref{Optimista vs Pessimista}, não precisamos de usar 2PC.

Esta conclusão é baseada no facto que quando um cliente deseja realizar commit ou abort este já obteve previamente todos os locks que necessitou e ainda não os libertou. Devido a isto quando um cliente deseja realizar commit ou abort, mesmo que tenha efectuado vários pedidos a \textit{Server}s diferentes basta que faça commit ou abort em cada um desses \textit{Server}s de forma a libertar os locks só passando ao \textit{Server} seguinte quando obtiver a confirmação que o commit ou abort num dado \textit{Server} foi bem sucedido.

Mesmo no caso em que um \textit{Server} falha ou os \textit{PadInt}s são redistribuídos para outro \textit{Server} em consequência de ter sido criado um novo par (primário, secundário) o cliente quando recebe uma excepção a informar que o que o servidor não respondeu ou que o \textit{PadInt} não foi encontrado, respectivamente, este pergunta novamente ao \textit{Master} qual é o \textit{Server} que guarda actualmente o \textit{PadInt}. Depois disto volta a re-enviar o pedido e irá obter uma resposta, pois ou o \textit{Server} foi recuperado devido à replicação passiva ou o cliente agora sim enviou o pedido para o \textit{Server} que guarda o \textit{PadInt}.

\input{commit.tex}
\input{aborts.tex}