\subsection{Master}

Esta classe gere o sistema de memória distribuída e é responsável por armazenar os dados globais do sistema.

A lista \textit{registered servers} tem como finalidade registar os servidores primários existentes, assim como, permitir identificar quais os \textit{PadInt}s atribuídos a cada servidor. Garantindo, que no caso em que o servidor primário é substituído, o endereço registado é actualizado e os clientes continuam a aceder aos \textit{PadInt}s sem perturbações. Para além disso, os identificadores das transações (\textit{TID}) são atribuídos de forma sequencial e única.

Quando um servidor é criado ele regista-se no \textit{Master} de forma a que lhe seja atribuído um papel (servidor primário ou secundário). Tendo em conta que esta solução usa replicação passiva é necessário existir um número par de servidores para atribuir um papel. Desta forma quando o primeiro servidor do par se regista ele irá ficar com estado \textit{FailedState}, pois ainda não tem um papel atribuído e não é suposto responder a nenhum pedido por parte do cliente. Quando o segundo servidor do par se regista é lhe atribuído o papel de servidor secundário (o servidor irá ter um estado \textit{BackupServer}). O servidor secundário irá de seguida atribuir o papel de servidor primário (estado \textit{PrimaryServer}) ao primeiro servidor do par. Esta atribuição do papel de servidor primário é feita pelo servidor secundário de forma a diminuir a carga no \textit{Master}.

\begin{table}[H]
\centering
\begin{tabular}{| p{2cm} | p{5cm} |}
\hline
\textbf{Variável} & \textbf{Descrição} \\
\hline
Last transaction
identifier & Último \textit{TID} atribuído \\
\hline
Registered
servers & Estrutura que armazena \textit{ Server Registry} referente a cada servidor primário registado no master \\
\hline
\end{tabular}
\caption{Atributos da classe Master}
\end{table}


\subsubsection{Server Registry}
A classe \textit{Server Registry} é responsável por armazenar o identificador e endereço de cada servidor primário registado no master. Para além disto, guarda também uma lista com os identificadores dos \textit{PadInt}s  (UID) que foram atribuídos ao servidor.

Na nossa solução optámos por guardar apenas os servidores primários no \textit{Master} em detrimento de guardar também os servidores secundários. Estes últimos precisam de ser conhecidos apenas pelos servidores primários, sendo que o master necessita apenas de lhes atribuir o seu papel (de servidor secundário) quando se tentam registar.

\subsubsection{LoadBalancer}
Com o objectivo de distribuir a carga pelos vários servidores criamos a classe \textit{Load Balancer}. Esta classe é usada, pelo \textit{Master}, para decidir qual o servidor primário a que deve ser atribuído um \textit{PadInt} na sua criação. Para esta distribuição o critério escolhido foi atribuir o novo \textit{PadInt} ao servidor primário que actualmente tem menos \textit{PadInt}s atribuídos.

Esta classe é também utilizada na redistribuição dos \textit{PadInt}s quando um novo par (primário, secundário) de servidores é criado. Nessa altura os \textit{PadInt}s são distribuídos de forma a que cada par de servidores fique com um número de \textit{PadInt}s aproximadamente igual. Este número resulta da média entre o número total de \textit{PadInt}s criados e o número de pares de servidores existentes.
